(function(){var t=function(t,e){return function(){return t.apply(e,arguments)}};!function(){var e,n,a,r,i,s;return r=function(){var e,n,a,r,i,s,o,d,l,p,c;return p=function(t,e){return $(t).tooltipster({theme:"tooltipster-light",animation:"grow",position:"bottom",content:e,contentAsHTML:!0}),$(t)},c=function(t){var e,n,a,r;n=t.ranking_projects||{},a=[];for(e in n)r=n[e],0!==r&&a.push(e);return a},d=function(t,e,n){var a,r,i,s,o,d,l,p,c,h;if(t=$.extend(!0,[],t),e)for(i=0,d=t.length;i<d;i++)r=t[i],r.times=(null!=(c=r.projects)?c[e]:void 0)||0;for(s=0,l=t.length;s<l;s++)a=t[s],a.total=Math.round(a.times*a.weight*10)/10;for(t=function(){var e,n,r;for(r=[],e=0,n=t.length;e<n;e++)a=t[e],a.times>0&&r.push(a);return r}(),t.sort(function(t,e){return e.total-t.total}),h=$("<table>"),n&&h.append('<tr class="project-header"><td colspan="2">'+(e+" ("+n+")</td></tr>")),o=0,p=t.length;o<p;o++)a=t[o],h.append("<tr><td>"+a.times+" "+a.label+'</td><td class="'+(a.total>0&&"plus"||"minus")+'">'+(a.total>0&&"+"||"")+a.total+"</td></tr>");return h},o=function(t){var e,n,a,r,i,s,o,l,h,u,g,m;if(g=$("<span>").addClass("score").text(t.ranking),h=c(t),h.length>0&&t.achievements){u=t.achievements;for(s in u)a=u[s],a.label=s;for(r=function(){var a,r;a=t.achievements,r=[];for(e in a)n=a[e],r.push(n);return r}(),m=$("<div>").addClass("score-tooltip"),i=0,o=h.length;i<o;i++)l=h[i],m.append(d(r,l,h.length>1&&t.ranking_projects[l]));p(g,m)}return g},e=function(t,e){var n,a,r,i,s,o,d,l,c,h;if(null==e&&(e=!1),n=$("<a>").addClass("badge").attr("href","#/x/analyzerPlugin/badges/"),n.append(t.awesomeFont),t.times>1&&n.append($("<sub>").text(t.times)),n.attr("title",t.name),h=$("<span>").addClass("badge-tooltip"),h.append($('<span class="badge-name">').text(t.name)),h.append($('<span class="badge-description">').text(t.description)),l=function(){var e,n;e=t.projects,n=[];for(o in e)c=e[o],c>0&&n.push({name:o,times:c});return n}(),e){for(l.sort(function(t,e){return e.times-t.times}),a=$('<ul class="badge-projects">'),r=0,i=l.length;r<i;r++)d=l[r],s=$("<li>"+d.name+"</li>"),d.times>1&&s.append("<span> ("+d.times+" times)</span>"),a.append(s);h.append(a)}return p(n,h)},n=function(t){var n,a,r,i,s,o;if(Object.keys(t.badges).length>0){o=c(t),r=$("<span>").addClass("badges"),i=t.badges,s=[];for(a in i)n=i[a],s.push(r.append(e(n,o.length>1)));return s}},i=function(t){var e;return t.stats?(t.avatar&&(e=$("<img>").addClass("avatar").attr("src",t.avatar).attr("onerror","$(this).css('display', 'none')")),$("<span>").addClass("developer-stats").append(e).append(t.name).append(o(t.stats)).append(n(t.stats))):""},s="https://review-analyzer.fslab.agh.edu.pl",new(r=function(){function e(e){this.developer=e,this.ready=t(this.ready,this)}return e.CACHE={},e.prototype.ready=function(t){return e.CACHE[this.developer.id]?t(e.CACHE[this.developer.id]):$.getJSON(s+"/review/api/badges/user/"+this.developer.email).done(function(n){return function(a){return t(e.CACHE[n.developer.id]=a)}}(this)).fail(function(){return t(null)})},e}()),setInterval(function(){return r.CACHE={}},3e5),l=new(function(){function e(){this.appendStatsTo=t(this.appendStatsTo,this),this.addDeveloperToDraw=t(this.addDeveloperToDraw,this),this.drawRankingStats=t(this.drawRankingStats,this),this.drawListStats=t(this.drawListStats,this),this.drawChangeDetailsStats=t(this.drawChangeDetailsStats,this),this.drawStats=t(this.drawStats,this),this.header=$("<div>").attr("id","analyzer-header"),$("#gerrit_header").after(this.header),this.requestNumber=0}return e.prototype.drawStats=function(t){var e;return null==t&&(t=5),this.header.children().remove(),this.developersToDraw={},(e=function(t){return function(n){return t.requestNumber++,$("#change_infoTable").length?t.drawChangeDetailsStats():$(".changeTable .cOWNER .accountLinkPanel").length?t.drawListStats():$(".ranking-badges").length?t.drawRankingStats():n>0?setTimeout(function(){return e(n-1)},500):void 0}}(this))(t)},e.prototype.drawChangeDetailsStats=function(){var t,e;return e=$(".com-google-gerrit-client-change-ChangeScreen_BinderImpl_GenCss_style-ownerPanel"),this.addDeveloperToDraw({name:e.find("a").text(),email:e.find("a").attr("title"),avatar:e.find("img").attr("src")}),$("#change_infoTable .com-google-gerrit-client-change-ChangeScreen_BinderImpl_GenCss_style-label_user").each(function(t){return function(e,n){return n=$(n).clone(),n.find("button").remove(),t.addDeveloperToDraw({name:n.text(),email:n.attr("title").split(" ")[0],avatar:n.find("img").attr("src")})}}(this)),t=$("<span>"),$(".com-google-gerrit-client-change-ChangeScreen_BinderImpl_GenCss_style-changeExtension").append("<hr>").append(t),this.appendStatsTo(t)},e.prototype.drawListStats=function(){return $(".changeTable .cOWNER .accountLinkPanel").each(function(t){return function(e,n){var a;return a=$(n).clone(),t.addDeveloperToDraw({name:a.find("a").text(),email:a.find("a").attr("title").match(/<(.+)>/)[1],avatar:a.find("img").attr("src")})}}(this)),this.appendStatsTo(this.header)},e.prototype.drawRankingStats=function(){return $(".ranking-badges").each(function(t){return function(t,e){var a;return a=$(e).attr("rel"),new r({id:a,email:a}).ready(function(t){return $(e).html(""),$(e).append(o(t)).append(n(t))})}}(this))},e.prototype.addDeveloperToDraw=function(t){return t.id=t.email,this.developersToDraw[t.id]=t},e.prototype.appendStatsTo=function(t){var e,n,a,s,o,d,l;n=this.requestNumber,s=Object.keys(this.developersToDraw).length,o=function(e){return function(){var n,a,r,s,o,d;for(r=function(){var t,e;t=this.developersToDraw,e=[];for(n in t)a=t[n],e.push(a);return e}.call(e),r.sort(function(t,e){var n,a;return(null!=(n=e.stats)?n.ranking:void 0)-(null!=(a=t.stats)?a.ranking:void 0)}),t.children().remove(),d=[],s=0,o=r.length;s<o;s++)a=r[s],d.push(t.append(i(a)));return d}}(this),d=this.developersToDraw,l=[];for(e in d)a=d[e],l.push(function(t){return function(e){return new r(e).ready(function(a){if(e.stats=a,--s<=0&&n===t.requestNumber)return o()})}}(this)(a));return l},e}()),a=new(function(){function e(){this.notifyAboutNewAchievements=t(this.notifyAboutNewAchievements,this),this.prepareStatsToCompare=t(this.prepareStatsToCompare,this),this.draw=t(this.draw,this)}return e.prototype.draw=function(){var t,e;return this.email=null!=(e=Gerrit.getCurrentUser())?e.email:void 0,this.email?(t={id:this.email,email:this.email},new r(t).ready(function(t){return function(e){if(t.currentStats=e,t.getContainer().children().remove(),t.getContainer().append(o(e)),t.getContainer().append(n(e)),!t.notified)return t.notifyAboutNewAchievements(),t.notified=!0}}(this))):this.getContainer().children().remove()},e.prototype.getContainer=function(){return 0===$("#currentUserBadges").length&&$(".menuBarUserName").after('<span id="currentUserBadges" class="developer-stats">'),$("#currentUserBadges")},e.prototype.prepareStatsToCompare=function(t){var e,n,a,r,i,s,o;null==t&&(t=this.currentStats),o={email:this.email,score:t.ranking,badges:{},achievements:{}},i=t.badges;for(a in i)r=i[a],o.badges[a]=r.times;s=t.achievements;for(e in s)n=s[e],n.weight>0&&(o.achievements[e]=n.times);return o},e.prototype.notifyAboutNewAchievements=function(){var t,e,n,a,r,i,s,o,d,l,p,c,h,u,g;if(this.currentStats){if(u=this.prepareStatsToCompare(),d=Cookies.getJSON("latestStats"),d&&d.email===this.email){l=$("<span>"),h=u.score-d.score,h>0&&(h=Math.round(10*h)/10,l.append($("<span>").addClass("score-gain").text("+"+h))),n=$("<ul>").addClass("achievements"),p=u.achievements;for(e in p)g=p[e],t=g-(d.achievements[e]||0),t>0&&n.append($("<li>").addClass("achievement").text("+"+t+" "+e));n.children().length&&l.append(n),i=$("<ul>").addClass("badges"),c=u.badges;for(r in c)g=c[r],a=g-(d.badges[r]||0),a>0&&(s=this.currentStats.badges[r].awesomeFont,o=this.currentStats.badges[r].name,i.append($("<li>").addClass("badge").html(s+" "+o)));i.children().length&&l.append(i),l.children().length&&$.tinyNotice(l.html(),"success",8e3)}return Cookies.set("latestStats",u,{expires:2,path:"/"})}},e}()),a.draw(),setInterval(a.draw,6e4),Gerrit.on("history",a.notifyAboutNewAchievements),Gerrit.on("history",l.drawStats),l.drawStats(15)},n=function(t){var e;return e=document.createElement("script"),e.type="text/javascript",e.src=t,document.head.append(e)},a=function(t){var e;return e=document.createElement("link"),e.rel="stylesheet",e.href=t,document.head.append(e)},i=function(){return $("<a>").tooltipster&&$.tinyNotice&&window.Cookies&&window.Gerrit?r():setTimeout(i,100)},s=function(){return window.jQuery?(n("https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/js/jquery.tooltipster.min.js"),n("https://gitcdn.xyz/repo/ebrahimiaval/tinyNotice/master/dist/tinyNotice.js"),n("https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.1.3/js.cookie.min.js"),i()):setTimeout(s,100)},n("https://code.jquery.com/jquery-2.2.4.min.js"),a("https://gitcdn.xyz/repo/ebrahimiaval/tinyNotice/master/dist/tinyNotice-theme.css"),a("https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"),a("https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/css/tooltipster.css"),a("https://cdnjs.cloudflare.com/ajax/libs/tooltipster/3.3.0/css/themes/tooltipster-light.min.css"),e=document.createElement("style"),e.setAttribute("type","text/css"),e.innerText=".analyzer-panel {\n    border-spacing: 0px 5px;\n}\n\n.analyzer-runButton {\n    margin-top: 22px !important;\n    margin-left: 120px !important;\n}\n\n.analyzer-selectProject {\n    width: 350px !important;\n}\n\n.analyzer-dataRow {\n    border-collapse: separate;\n    border-spacing: 10px 5px;\n}\n\n.ranking-table > tbody > tr:first-child {\n    display: none;\n}\n\n.ranking-table img {\n    max-height: 20px\n}\n\n.ranking-table > tbody > tr:nth-child(2) {\n    background: gold;\n    font-size: 2em;\n}\n\n.ranking-table > tbody > tr:nth-child(2) img {\n    max-height: 40px;\n}\n\n.ranking-table > tbody > tr:nth-child(3) {\n    background: silver;\n    font-size: 1.7em;\n}\n\n.ranking-table > tbody > tr:nth-child(4) {\n    background: burlywood;\n    font-size: 1.3em;\n}\n\n.ranking-table td {\n    font-size: inherit;\n}\n\n.analyzer-popup {\n    width: 500px;\n    height: 500px;\n    left: 550px !important;\n    top: 200px !important;\n}\n\n.analyzer-popupPanel {\n    width: 480px;\n    height: 20px;\n}\n\n.analyzer-commentsList {\n    margin-left: 15px;\n}\n\n.analyzer-nodeGraph {\n    margin-left: 15px;\n}\n\n.developer-stats .score {\n    background: darkgreen;\n    font-weight: bold;\n    color: white;\n    border-radius: 5px;\n    padding: 1px 4px;\n    display: inline-block;\n    margin: 0 3px;\n    line-height: 1.2em;\n    font-size: 0.9em;\n    cursor: default;\n}\n\n.developer-stats .badge {\n    display: inline-block;\n    margin: 0 2px;\n    text-decoration: none;\n    outline: none;\n    color: inherit;\n}\n\n.developer-stats .badge sub {\n    font-weight: bold;\n}\n\n.developer-stats .avatar {\n    max-height: 15px;\n    margin-right: 3px;\n}\n\n#analyzer-header {\n    padding: 5px;\n    text-align: center;\n    font-size: 1.3em;\n}\n\n#analyzer-header .developer-stats {\n    display: inline-block;\n    margin: 5px 10px;\n}\n\n.com-google-gerrit-client-change-ChangeScreen_BinderImpl_GenCss_style-changeExtension .developer-stats {\n    display: block;\n    margin: 5px 0;\n}\n\n.score-tooltip tr.project-header {\n    font-weight: bold;\n    text-align: center;\n}\n\n.score-tooltip table {\n    margin-top: 5px;\n    padding-top: 5px;\n    width: 100%;\n}\n\n.score-tooltip table:first-child {\n    margin: 0;\n    padding: 0;\n}\n\n.score-tooltip .minus {\n    font-weight: bold;\n    color: darkred;\n}\n\n.score-tooltip .plus {\n    font-weight: bold;\n    color: darkgreen;\n}\n\n.menuBarUserNamePanel {\n    font-size: 15px;\n}\n\n@media screen and (max-width: 1370px) {\n    input.searchTextBox {\n        max-width: 300px;\n    }\n}\n\n.badge-tooltip .badge-name {\n    font-weight: bold;\n}\n\n.badge-tooltip > span {\n    display: block;\n}\n\n.badge-tooltip .badge-projects {\n    padding-left: 25px;\n    margin: 0;\n    margin-top: 5px;\n}\n\n.tinyNoticeWrap.success .score-gain {\n    display: block;\n    font-size: 2em;\n    font-weight: bold;\n    text-align: center;\n}\n\n.tinyNoticeWrap.success ul {\n    list-style-type: none;\n    padding: 0\n}\n\n.tinyNoticeWrap.success ul .fa {\n    color: white !important;\n    width: 30px;\n    text-align: center\n}\n",document.head.append(e),s()}()}).call(this);